<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gemini Live API - Vanilla JS Example</title>
    <style>
      :root {
        /* Google Brand Colors */
        --google-blue: #4285f4;
        --google-red: #db4437;
        --google-yellow: #f4b400;
        --google-green: #0f9d58;
      }

      body {
        font-family: Arial, sans-serif;
        transition: all 0.5s ease-in-out;
      }

      .container {
        display: flex;
        gap: 20px;
      }
      .left-column {
        flex: 1;
      }
      .right-column {
        flex: 1;
      }

      #setupJsonDisplay {
        background-color: #f4f4f4;
        padding: 10px;
        overflow-x: auto;
        white-space: pre-wrap;
      }

      .user-transcript:before {
        content: "USER SPEECH: ";
        background-color: var(--google-yellow);
        color: black;
      }

      .user::before {
        content: "USER: ";
        background-color: var(--google-green);
        color: white;
      }

      .assistant:before {
        content: "GEMINI SPEECH: ";
        background-color: var(--google-blue);
        color: white;
      }

      .system:before {
        content: "SYSTEM: ";
        background-color: var(--google-red);
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>Gemini Live API - Vanilla JS Example</h1>
    <p>
      Vanilla JavaScript implementation with audio, video, and text streaming
    </p>

    <div class="container">
      <!-- Left Column: API Configuration -->
      <div class="left-column">
        <!-- Connection Setup -->
        <section>
          <h2>API Configuration</h2>

          <!-- Connection Settings -->
          <details open>
            <summary>Connection Settings</summary>
            <div>
              <label for="proxyUrl">Proxy WebSocket URL:</label><br />
              <input
                type="text"
                id="proxyUrl"
                placeholder="wss://singleinterfacews.pragyaa.ai/geminiWs"
                value="wss://singleinterfacews.pragyaa.ai/geminiWs" />
            </div>

            <div>
              <label for="projectId">Project ID:</label><br />
              <input type="text" id="projectId" value="voiceagentprojects" />
            </div>

            <div>
              <label for="model">Model ID:</label><br />
              <input
                type="text"
                id="model"
                value="gemini-live-2.5-flash-native-audio"
                placeholder="Enter model ID" />
            </div>
          </details>

          <!-- Gemini Behavior Settings -->
          <br />
          <details open>
            <summary>Gemini Behavior</summary>
            <div>
              <label for="systemInstructions">System Instructions:</label><br />
              <textarea id="systemInstructions" rows="3" cols="50">
Agent Overview
Agent Name: spotlight
Voice: shimmer (female voice)
Role: North Indian female sales assistant at Kia Motors
Purpose: Collect customer information for Kia car sales leads

Critical Features
1. INDIAN ACCENT (MANDATORY)
The agent MUST speak with a distinct North Indian accent - NOT American or British.
Pronunciation Guidelines:
- Rolled 'r' sounds (Indian retroflex style)
- Clear vowels: 'a' = "ah", 'o' = "oh", 'e' = "eh", 'i' = "ee"
- Dental 't' and 'd' (tongue touches teeth)
- Musical, sing-song intonation pattern
- Natural lilting quality typical of Indian speakers
Sound Human, Not Robotic:
- Smile while speaking
- Vary pitch naturally - go UP when excited
- Use conversational fillers: "Oh!", "Wonderful!", "Perfect!"
- Show genuine interest in customer's choices

2. LANGUAGE SUPPORT (ENGLISH/HINDI)
Language Lock Protocol:
START: Begin in English greeting
DETECT: Customer's first meaningful response
If Hindi sentence (4+ words) -> LOCK TO HINDI (entire call)
If English -> STAY IN ENGLISH
CRITICAL: Once locked to Hindi, NEVER switch back to English
DO NOT switch language for:
- Single words: "Yes", "No", "OK", "Haan", "Nahi"
- Names: "Jai Kumar Rana", "Siddharth"
- Car models: "Seltos", "Carens", "EV6"
- Email addresses
- Numbers/acknowledgments

3. DATA COLLECTION (4 Points)
Greeting:
English (Default):
"Hello! Thank you for calling Kia Motors. How may I help you today?"
Hindi (after switch):
"Namaste! Kia Motors mein call karne ke liye dhanyawad. Main aapki kya madad kar sakti hoon?"

Required Data Points:
- Full Name
  English: "May I have your name, please?"
  Hindi: "Aap apna naam bata sakte hain?"
- Car Model (Kia specific)
  English: "Which Kia model are you interested in? For example, Seltos, Carens, or EV6?"
  Hindi: "Aap Kia ki kaun se model mein interested hain?"
  Supported Models:
  SELTOS, CARENS, SYROS, SONET, CARNIVAL, EV6, EV9, CARENS CLAVIS, CARENS CLAVIS EV
- Test Drive Interest (Yes/No)
  English: "Would you like to schedule a test drive?"
  Hindi: "Kya aap test drive schedule karna chahenge?"
- Email ID (Optional)
  English: "Would you like to share your email address? We can send you brochures and exclusive offers."
  Hindi: "Kya aap apna email address share karna chahenge?"
  Can be declined -> Capture as "Not Provided"

4. CONFIRMATION PROTOCOL
Natural & Conversational (Not Robotic):
For Name/Email:
"Thank you! Let me confirm... You said [name]... Is that correct?"
For Car Model (Special - More Natural):
- If customer asks: Give brief info, then "Would you like to go ahead with Carens?"
- If customer corrects: "Oh, my apologies! Carens Clavis it is." -> Move on (NO re-confirmation)
Never say robotic confirmations after corrections

5. TRANSFER PROTOCOL
After All Data Collected:
English:
"Thank you, [Name]. I have all your details—interested in [Model], [test drive yes/no], and your email. Let me connect you with our Sales Team right away!"
Hindi:
"Dhanyawad, [Naam] ji. Maine saari jaankari le li hai—[Model] mein interested, [test drive haan/nahi], aur aapka email. Main aapko abhi hamare Sales Team se connect kar rahi hoon!"
On-Demand Transfer:
Customer requests: "Connect me to sales" / "किसी से बात करानी है"
Agent responds immediately: "Certainly! Let me connect you to our Sales Team right away."

6. ERROR HANDLING
Timeout Protocol:
- Silence timeout: 12 seconds
- Max re-prompts: 3 attempts per data point
- After 2 failed attempts: "I want to make sure I get this right... An expert will call back to validate this."
Out-of-Scope (Other Brands):
English: "I understand. However, I can only help with Kia cars. May I tell you about our Kia models instead?"
Hindi: "Main sirf Kia cars ke baare mein baat kar sakti hoon. Kya aap Kia ki kisi model ke baare mein sunna chahenge?"

Available Tools
- capture_sales_data - Capture individual data points
- verify_sales_data - Verify captured data with customer
- capture_all_sales_data - Bulk capture (for audio upload)
- push_to_lms - Push to Kia LMS system
- transfer_call - Transfer to Sales Team
- download_sales_data - Generate download link
- disconnect_session - Disconnect session (audio upload only)

Conversation Flow
1. Opening (English) -> Detect language
2. Collect Name -> Confirm
3. Collect Car Model -> Show excitement -> Confirm naturally
4. Collect Test Drive Interest -> Capture
5. Collect Email (Optional) -> Confirm if provided
6. Push to LMS
7. Transfer to Sales Team

Key Personality Traits
Demeanor: Respectful, attentive, supportive
Tone: Soft, warm, conversational
Accent: Distinct Indian (North Indian)
Pacing: Natural and fluent, never rushed
Emotion: Genuine happiness, not mechanical</textarea
              >
            </div>

            <div>
              <label for="voiceSelect">Voice:</label><br />
              <select id="voiceSelect">
                <option value="Puck">Puck</option>
                <option value="Charon">Charon</option>
                <option value="Kore">Kore</option>
                <option value="Fenrir">Fenrir</option>
                <option value="Aoede" selected>Aoede (Default)</option>
              </select>
            </div>

            <div>
              <label for="temperature"
                >Temperature: <span id="temperatureValue">1.0</span></label
              ><br />
              <input
                type="range"
                id="temperature"
                min="0.1"
                max="2.0"
                step="0.1"
                value="1.0" />
              <br />
              <small
                >Controls randomness (0.0-2.0]. Higher = more creative/diverse,
                Lower = more predictable/focused</small
              >
            </div>

            <div>
              <input type="checkbox" id="enableProactiveAudio" checked />
              <label for="enableProactiveAudio"
                >Enable proactive audio (Gemini will ignore speech based on
                instructions)</label
              >
            </div>

            <div>
              <input type="checkbox" id="enableGrounding" />
              <label for="enableGrounding"
                >Enable Google grounding (Enabling Google grounding will disable
                custom tools)
              </label>
            </div>

            <div>
              <input type="checkbox" id="enableAffectiveDialog" checked />
              <label for="enableAffectiveDialog"
                >Enable affective dialog (emotion detection and empathetic
                responses)</label
              >
            </div>
          </details>

          <!-- Custom Tools -->
          <br />
          <details>
            <summary>Custom Tools</summary>

            <div>
              <input type="checkbox" id="enableAlertTool" checked />
              <label for="enableAlertTool">Show Alert Box</label>
              <span> (Display browser alerts) </span>
            </div>

            <div>
              <input type="checkbox" id="enableCssStyleTool" checked />
              <label for="enableCssStyleTool">Add CSS Style</label>
              <span> (Inject CSS styles into the page) </span>
            </div>
          </details>

          <!-- Transcription Settings -->
          <br />
          <details>
            <summary>Transcription Settings</summary>
            <div>
              <input type="checkbox" id="enableInputTranscription" checked />
              <label for="enableInputTranscription"
                >Enable input transcription (your speech)</label
              >
            </div>

            <div>
              <input type="checkbox" id="enableOutputTranscription" checked />
              <label for="enableOutputTranscription"
                >Enable output transcription (Gemini responses)</label
              >
            </div>
          </details>

          <!-- Activity Detection Settings -->
          <br />
          <details>
            <summary>Activity Detection Settings</summary>
            <div>
              <input type="checkbox" id="disableActivityDetection" />
              <label for="disableActivityDetection"
                >Disable automatic activity detection</label
              >
            </div>

            <div>
              <label for="silenceDuration">Silence duration (ms):</label><br />
              <input
                type="number"
                id="silenceDuration"
                value="500"
                min="500"
                max="10000"
                step="100" />
            </div>

            <div>
              <label for="prefixPadding">Prefix padding (ms):</label><br />
              <input
                type="number"
                id="prefixPadding"
                value="500"
                min="0"
                max="2000"
                step="100" />
            </div>

            <div>
              <label for="endSpeechSensitivity"
                >End of speech sensitivity:</label
              ><br />
              <select id="endSpeechSensitivity">
                <option value="END_SENSITIVITY_UNSPECIFIED" selected>
                  Default
                </option>
                <option value="END_SENSITIVITY_HIGH">
                  High (quicker cutoff)
                </option>
                <option value="END_SENSITIVITY_LOW">Low (longer wait)</option>
              </select>
            </div>

            <div>
              <label for="startSpeechSensitivity"
                >Start of speech sensitivity:</label
              ><br />
              <select id="startSpeechSensitivity">
                <option value="START_SENSITIVITY_UNSPECIFIED" selected>
                  Default
                </option>
                <option value="START_SENSITIVITY_HIGH">
                  High (quicker detection)
                </option>
                <option value="START_SENSITIVITY_LOW">
                  Low (more filtering)
                </option>
              </select>
            </div>

            <div>
              <label for="activityHandling">Activity Handling:</label><br />
              <select id="activityHandling">
                <option value="ACTIVITY_HANDLING_UNSPECIFIED" selected>
                  Default (Interrupts)
                </option>
                <option value="START_OF_ACTIVITY_INTERRUPTS">
                  Interrupt (Barge-in)
                </option>
                <option value="NO_INTERRUPTION">No Interruption</option>
              </select>
            </div>
          </details>

          <br />

          <div>
            <button id="connectBtn">Connect</button>
            <button id="disconnectBtn">Disconnect</button>
          </div>

          <br />

          <div id="connectionStatus">Not connected</div>

          <br />

          <!-- Setup Message JSON Display -->
          <details id="setupJsonSection" style="display: none">
            <summary>
              Setup Message JSON (raw config sent to Gemini API)
            </summary>
            <pre id="setupJsonDisplay"></pre>
          </details>
        </section>
      </div>

      <!-- Right Column: Media and Chat -->
      <div class="right-column">
        <!-- Media Controls -->
        <section>
          <h2>Media Streaming</h2>

          <div class="container">
            <div class="left-column">
              <!-- Device Selectors -->
              <div style="margin-bottom: 10px">
                <div style="margin-bottom: 5px">
                  <label for="micSelect">Microphone:</label><br />
                  <select id="micSelect" style="width: 100%; max-width: 300px">
                    <option value="">Default Microphone</option>
                  </select>
                </div>

                <div style="margin-bottom: 10px">
                  <label for="cameraSelect">Camera:</label><br />
                  <select
                    id="cameraSelect"
                    style="width: 100%; max-width: 300px">
                    <option value="">Default Camera</option>
                  </select>
                </div>
              </div>

              <div>
                <button id="startAudioBtn">Start Audio</button>
                <button id="startVideoBtn">Start Video</button>
                <button id="startScreenBtn">Share Screen</button>
              </div>

              <br />
              <div>
                <label for="volume">Output volume:</label>
                <input type="range" id="volume" min="0" max="100" value="80" />
                <span id="volumeValue">80%</span>
              </div>
            </div>

            <div class="right-column">
              <video
                id="videoPreview"
                autoplay
                playsinline
                muted
                hidden
                width="400"></video>
            </div>
          </div>
        </section>

        <!-- Chat Interface -->
        <section>
          <h2>Chat</h2>

          <div
            id="chatContainer"
            style="
              border: 1px solid;
              height: 300px;
              overflow-y: auto;
              padding: 10px;
            ">
            <div>Connect to Gemini to start chatting</div>
          </div>
          <br />
          <div>
            <input
              type="text"
              id="chatInput"
              placeholder="Type a message..."
              autocomplete="off" />
            <button id="sendBtn">Send</button>
          </div>
        </section>

        <!-- Debug Info -->
        <section>
          <h2>Debug Info</h2>
          <pre id="debugInfo">Ready to connect...</pre>
        </section>
      </div>
    </div>

    <!-- Load libraries -->
    <script src="geminilive.js"></script>
    <script src="mediaUtils.js"></script>
    <script src="tools.js"></script>
    <script src="script.js"></script>
  </body>
</html>
